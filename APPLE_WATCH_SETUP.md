# 🏃‍♂️ Apple Watch 운동 데이터 자동 업로드 가이드

이 가이드는 Apple Watch 운동 데이터를 iPhone 단축어를 통해 자동으로 BetterLife 서버에 업로드하는 방법을 설명합니다.

---

## 📱 단축어 설정 방법

### **1단계: 새 단축어 만들기**

1. iPhone에서 **단축어** 앱 열기
2. **+** 버튼 눌러 새 단축어 생성
3. 이름: "운동 데이터 업로드"

---

### **2단계: 액션 추가**

#### **액션 1: 최근 운동 가져오기**
```
검색: "건강 샘플 찾기"
- 유형: 운동 (Workout)
- 정렬: 시작 날짜 (최신순)
- 개수: 1개
```

#### **액션 2: 운동 기본 정보 추출**
```
검색: "건강 세부사항 가져오기"
다음 항목 선택:
- 운동 유형 (Workout Type)
- 시작 날짜 (Start Date)
- 종료 날짜 (End Date)
- 지속 시간 (Duration)
- 거리 (Distance)
- 활성 에너지 (Active Energy)
- 총 에너지 (Total Energy)
```

#### **액션 3: 심박수 Raw 데이터 가져오기**
```
검색: "건강 샘플 찾기"
- 유형: 심박수 (Heart Rate)
- 필터 추가:
  * 시작 날짜 >= [운동 시작 날짜]
  * 종료 날짜 <= [운동 종료 날짜]
- 정렬: 시작 날짜
- 개수: 제한 없음
```

#### **액션 4: 심박수 배열 생성**
```
검색: "반복"
- 반복 대상: [심박수 샘플]
- 각 항목에 대해:
  1. "딕셔너리" 액션 추가
     - timestamp: [반복 항목의 시작 날짜]
     - bpm: [반복 항목의 값]
  2. "목록에 추가" 액션
     - 변수 이름: heart_rate_samples
```

#### **액션 5: (선택) 페이스 데이터 가져오기**
```
검색: "건강 샘플 찾기"
- 유형: 달리기 속도 (Running Speed)
- 필터: 운동 시간 범위
- 정렬: 시작 날짜
```

#### **액션 6: (선택) 케이던스 데이터 가져오기**
```
검색: "건강 샘플 찾기"
- 유형: 달리기 케이던스 (Running Cadence)
- 필터: 운동 시간 범위
```

#### **액션 7: JSON 데이터 생성**
```
검색: "딕셔너리"
다음 키-값 입력:

user_id: "your_user_id"  (본인 ID로 변경)
workout_type: [운동 유형]
start_time: [시작 날짜]
end_time: [종료 날짜]
duration_seconds: [지속 시간 (초)]
distance_meters: [거리 (미터)]
active_calories: [활성 에너지]
total_calories: [총 에너지]
avg_heart_rate: [평균 심박수]
max_heart_rate: [최대 심박수]
min_heart_rate: [최소 심박수]
heart_rate_samples: [heart_rate_samples 변수]
```

#### **액션 8: API 전송**
```
검색: "URL 내용 가져오기"
- URL: https://betterlife-zeta.vercel.app/api/workouts
- 방법: POST
- 헤더:
  * Content-Type: application/json
- 요청 본문: JSON
  * 선택: [딕셔너리]
```

#### **액션 9: 결과 확인 (선택)**
```
검색: "알림 표시"
- 제목: "운동 데이터 업로드 완료"
- 본문: "거리: [거리]km, 시간: [시간]분"
```

---

## 🤖 자동화 설정

### **운동 종료 시 자동 실행**

1. **단축어** 앱에서 **자동화** 탭 선택
2. **+** 버튼 → **개인용 자동화 생성**
3. 트리거 선택: **운동**
4. 조건: **운동 종료 시**
5. 액션 추가: **단축어 실행**
   - 선택: "운동 데이터 업로드"
6. **실행 전에 묻기** 끄기 (자동 실행)
7. 완료

---

## 📊 데이터 구조 예시

```json
{
  "user_id": "user123",
  "workout_type": "running",
  "start_time": "2026-01-02T18:00:00Z",
  "end_time": "2026-01-02T18:45:00Z",
  "duration_seconds": 2700,
  "distance_meters": 5000,
  "active_calories": 400,
  "total_calories": 450,
  "avg_heart_rate": 150,
  "max_heart_rate": 180,
  "min_heart_rate": 120,
  "heart_rate_samples": [
    { "timestamp": "2026-01-02T18:00:00Z", "bpm": 120 },
    { "timestamp": "2026-01-02T18:01:00Z", "bpm": 135 },
    { "timestamp": "2026-01-02T18:02:00Z", "bpm": 145 }
    // ... 더 많은 샘플
  ]
}
```

---

## ⚠️ 주의사항

### **데이터 크기 제한**
- 심박수 샘플 최대: 10,000개
- 긴 운동(2시간+)의 경우 샘플링 필요
- 해결: 10초마다 1개씩만 선택

### **샘플링 방법**
```
반복 액션에서:
- 인덱스 % 10 == 0 인 경우에만 추가
```

### **배터리 절약**
- Wi-Fi 연결 시에만 업로드
- 조건 추가: "Wi-Fi에 연결됨"

---

## 🎯 테스트 방법

1. Apple Watch로 짧은 운동 (5분 걷기)
2. 운동 종료
3. iPhone 단축어 앱에서 "운동 데이터 업로드" 수동 실행
4. 알림으로 성공 확인
5. BetterLife 앱에서 데이터 확인

---

## 🆘 문제 해결

### **"권한이 없습니다" 오류**
- 설정 → 개인정보 보호 → 건강
- 단축어 앱에 모든 권한 허용

### **"데이터가 없습니다" 오류**
- Apple Watch와 iPhone 동기화 확인
- 건강 앱에서 데이터 확인

### **"업로드 실패" 오류**
- 인터넷 연결 확인
- API URL 확인
- user_id 확인

---

## 📈 다음 단계

데이터가 성공적으로 업로드되면:
1. BetterLife 메인 페이지에서 운동 요약 확인
2. `/workouts` 페이지에서 상세 기록 확인
3. 심박수 그래프로 운동 강도 분석

**Happy Running! 🏃‍♂️💪**
